<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>LogScrubber</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
<div class="header">
<h1>esb-a-erfurt.test.elex.be</h1>
<div class="searchDiv">
    <div id="filterInput"></div>
    <div id="sliceInput">
        <input placeholder="Time Slice..." type="text" id="timeslice"/><a href="#" class="button" id="getSlice">get slice</a>
    </div>
</div>
</div>
<hr/>
<table id="dashboard">
  <tr>
    <td>
      <div id="stringControl"></div>
    </td>
    <td>
      <div id="tableChart"></div>
    </td>
  </tr>
</table>

<link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'/>
<link href='../static/style.css' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>
<script type="text/javascript">
  google.load('visualization', '1.1', {packages: ['controls']});
</script>
<script>
// http://paletton.com/#uid=40s0n0kjQCW6Ni6bCrS6OyU1-uc
//    <![CDATA[
var client = new XMLHttpRequest();

var chartData = [['Tag', 'Average', {'type': 'string', 'role': 'tooltip'}]];
var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard'));
var dataTable = new google.visualization.DataTable();
var options;
var tags;

google.visualization.events.addListener(dashboard, 'ready', function () {
  $(".google-visualization-controls-label").remove();
  var input = $("#4-input").detach();
  $("#filterInput").append(input);
  input.attr("placeholder", "Filter...");
  input.focus();
});

function drawBasic() {
  dataTable.addColumn('string', 'Tag');
  dataTable.addColumn('number', 'Average');
  // A column for custom tooltip content
  dataTable.addColumn({type: 'string', role: 'tooltip'});

  for (var i in tags.logLines) {
    var row = tags.logLines[i];
    dataTable.addRow([row.tag, row.average, row.tag + "\n" + row.average + " seconds."]);
  }

  options = { 'title': tags.range, 'tooltip': { isHtml: true },
    'chartArea': {'width': '60%', 'height': '80%', 'left': '40%'},
    'titleTextStyle': {
      fontSize: '30',
      color: '#6AA67A'
    },
    'colors': ['#9BC4A6'],
    'backgroundColor': '#191E24',
    'legend': 'none',
    'hAxis': {
      textStyle: {
        color: '#6AA67A'
      },
      direction: 1,
      title: 'Seconds',
      titleTextStyle: {
        color: '#6AA67A'
      },
      minValue: 0
    },
    'vAxis': {
      textStyle: {
        color: '#6AA67A'
      }
    }};

  var stringFilter = new google.visualization.ControlWrapper({
    'controlType': 'StringFilter',
    'containerId': 'stringControl',
    'options': {
      'matchType': 'any',
      'caseSensitive': 'false',
      'filterColumnLabel': 'Tag'
    }
  });

  var table = new google.visualization.ChartWrapper({
    'chartType': 'BarChart',
    'containerId': 'tableChart',
    'options': options
  });

  dashboard.bind(stringFilter, table);
}

$.ajax({
    url: "http://localhost:8090/json?host=esb-a-test.erfurt.elex.be&from=1460453400000&till=1460453700000",
}).then(function(data) {
    tags = data;
    drawBasic();
    dashboard.draw(dataTable);
});

//    ]]>
</script>
</body>
</html>
